<!-- templates/data_entry/create_department.html - FACULTY SEÇİMİ EKLENDİ -->
{% extends "base.html" %}

{% block title %}Add Department - Schedule Optimizer{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">
            <i class="fas fa-plus me-2"></i>Add Department
        </h1>
        <a href="{{ url_for('data_entry.departments') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>Back to Departments
        </a>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header">
                    <h6 class="m-0 font-weight-bold text-primary">Department Information</h6>
                </div>
                <div class="card-body">
                    <form method="POST" id="departmentForm">
                        <!-- Faculty Selection - YENİ EKLENEN -->
                        <div class="mb-4">
                            <label for="faculty_id" class="form-label">
                                <i class="fas fa-university me-1"></i>Faculty *
                            </label>
                            <select class="form-select" id="faculty_id" name="faculty_id" required>
                                <option value="">Select Faculty</option>
                                {% for faculty in faculties %}
                                    <option value="{{ faculty.id }}" 
                                            data-building="{{ faculty.building or '' }}"
                                            data-code="{{ faculty.code }}">
                                        {{ faculty.name }} ({{ faculty.code }})
                                    </option>
                                {% endfor %}
                            </select>
                            <div class="form-text">Choose which faculty this department belongs to</div>
                        </div>

                        <!-- Basic Information -->
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="name" class="form-label">
                                    <i class="fas fa-building me-1"></i>Department Name *
                                </label>
                                <input type="text" class="form-control" id="name" name="name" required 
                                       placeholder="e.g. Computer Engineering">
                                <div class="invalid-feedback" id="nameError"></div>
                            </div>
                            <div class="col-md-4">
                                <label for="code" class="form-label">
                                    <i class="fas fa-code me-1"></i>Department Code
                                </label>
                                <input type="text" class="form-control" id="code" name="code" 
                                       placeholder="Auto-generated" style="text-transform: uppercase;">
                                <div class="form-text">Leave empty for auto-generation</div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="num_grades" class="form-label">
                                    <i class="fas fa-layer-group me-1"></i>Number of Grades *
                                </label>
                                <select class="form-select" id="num_grades" name="num_grades" required>
                                    <option value="">Select...</option>
                                    <option value="3">3 Grades (Associate)</option>
                                    <option value="4" selected>4 Grades (Bachelor)</option>
                                    <option value="5">5 Grades (5-Year Program)</option>
                                    <option value="6">6 Grades (Medicine/Vet)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="head_of_department" class="form-label">
                                    <i class="fas fa-user-tie me-1"></i>Head of Department
                                </label>
                                <input type="text" class="form-control" id="head_of_department" 
                                       name="head_of_department" placeholder="Full Name">
                            </div>
                        </div>

                        <!-- Location Information -->
                        <div class="card bg-light mb-3">
                            <div class="card-body">
                                <h6 class="card-title text-secondary">
                                    <i class="fas fa-map-marker-alt me-1"></i>Location & Contact Information
                                </h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="building" class="form-label">Building</label>
                                        <input type="text" class="form-control" id="building" name="building" 
                                               placeholder="e.g. Engineering Building">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="floor" class="form-label">Floor</label>
                                        <input type="number" class="form-control" id="floor" name="floor" 
                                               placeholder="e.g. 3" min="1" max="20">
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <label for="phone" class="form-label">Phone</label>
                                        <input type="tel" class="form-control" id="phone" name="phone" 
                                               placeholder="e.g. +90 212 xxx xxxx">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="email" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="email" name="email" 
                                               placeholder="e.g. department@university.edu.tr">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Form Actions -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('data_entry.departments') }}" class="btn btn-secondary">
                                <i class="fas fa-times me-1"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>Save Department
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    // Auto-generate code from name
    $('#name').on('blur', function() {
        const name = $(this).val().trim();
        const codeField = $('#code');
        
        if (name && !codeField.val()) {
            const words = name.split(' ');
            let code = '';
            
            if (words.length >= 2) {
                code = words.slice(0, 2).map(word => word.charAt(0).toUpperCase()).join('');
            } else {
                code = name.substring(0, 3).toUpperCase();
            }
            
            codeField.val(code);
        }
    });
    
    // Auto-fill building from faculty
    $('#faculty_id').change(function() {
        const selected = $(this).find('option:selected');
        const facultyBuilding = selected.data('building');
        
        if (facultyBuilding && !$('#building').val()) {
            $('#building').val(facultyBuilding);
        }
    });
    
    // Form validation
    $('#departmentForm').submit(function(e) {
        let isValid = true;
        
        // Check required fields
        if (!$('#faculty_id').val()) {
            alert('Please select a faculty');
            isValid = false;
        }
        
        if (!$('#name').val().trim()) {
            alert('Please enter department name');
            isValid = false;
        }
        
        if (!$('#num_grades').val()) {
            alert('Please select number of grades');
            isValid = false;
        }
        
        if (!isValid) {
            e.preventDefault();
        }
    });
});
</script>

<style>
.card-body .form-label i {
    color: #6c757d;
}

.bg-light {
    background-color: #f8f9fa !important;
}

.form-control:focus,
.form-select:focus {
    border-color: #4e73df;
    box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
}
</style>
{% endblock %}